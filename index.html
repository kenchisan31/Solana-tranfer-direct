<!DOCTYPE html>
<html lang="vi">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>BNB Web3Modal DApp - KÃ­ch hoáº¡t khi Click & Chuyá»ƒn tiá»n</title>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  body { font-family: sans-serif; margin: 20px; text-align: center; }
Â  Â  Â  Â  .container { max-width: 400px; margin: 50px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .message { margin-top: 20px; padding: 10px; border-radius: 4px; font-size: 0.9em; }
Â  Â  Â  Â  .error { background-color: #fdd; color: #d00; border: 1px solid #f99; }
Â  Â  Â  Â  .success { background-color: #dfd; color: #0d0; border: 1px solid #9f9; }
Â  Â  Â  Â  button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
Â  Â  Â  Â  #connect-wallet { background-color: #4CAF50; color: white; }
Â  Â  Â  Â  /* Thay tháº¿ nÃºt transfer báº±ng nÃºt chá»©c nÄƒng chÃ­nh */
Â  Â  Â  Â  #main-action-button { background-color: #FFC04D; color: #333; font-weight: bold; margin-top: 15px; }
Â  Â  Â  Â  #main-action-button:disabled { opacity: 0.5; cursor: not-allowed; }
Â  Â  Â  Â  #disconnect-button { background-color: #999; color: white; }
Â  Â  </style>

Â  Â  <script type="module">
Â  Â  Â  Â  import { createWeb3Modal, defaultWagmiConfig } from 'https://cdn.jsdelivr.net/npm/@web3modal/wagmi@5.0.0/+esm';
Â  Â  Â  Â  // Chá»‰ cáº§n import cÃ¡c hÃ m cáº§n thiáº¿t
Â  Â  Â  Â  import { getAccount, getPublicClient, getWalletClient, disconnect } from 'https://cdn.jsdelivr.net/npm/@wagmi/core@2.11.7/+esm';Â 
Â  Â  Â  Â  import { bsc, bscTestnet } from 'https://cdn.jsdelivr.net/npm/@wagmi/core@2.11.7/chains/+esm';
Â  Â  Â  Â  import { parseEther } from 'https://cdn.jsdelivr.net/npm/viem@2.17.0/+esm';

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // Cáº¤U HÃŒNH DAPP
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  const projectId = '4b51b4de2a00fad2b344df9322b5fd06';Â 
Â  Â  Â  Â  const PROJECT_WALLET_ADDRESS_BNB = '0xc33A186374A2C5360A0ad06B3131ecBb9043c32a';
Â  Â  Â  Â  // LÆ°á»£ng BNB nhá» Ä‘á»ƒ "transfer" (dÃ¹ng nhÆ° phÃ­ gas vÃ­ dá»¥ 0.0001 BNB)
Â  Â  Â  Â  const AMOUNT_TO_SEND = "0.0001"; 
Â  Â  Â  Â  const REQUIRED_CHAIN = bsc; // BSC Mainnet
Â  Â  Â  Â  const EXPLORER_URL = "https://bscscan.com/tx/";

Â  Â  Â  Â  // Cáº¥u hÃ¬nh Wagmi (AutoConnect Ä‘Æ°á»£c khuyáº¿n nghá»‹)
Â  Â  Â  Â  const chains = [REQUIRED_CHAIN, bscTestnet];Â 
Â  Â  Â  Â  const metadata = {
Â  Â  Â  Â  Â  Â  name: 'BNB Web3 DApp Demo',
Â  Â  Â  Â  Â  Â  description: 'Gá»­i BNB qua Web3Modal',
Â  Â  Â  Â  Â  Â  url: window.location.origin,
Â  Â  Â  Â  Â  Â  icons: ['https://avatars.githubusercontent.com/u/37784886']
Â  Â  Â  Â  };

Â  Â  Â  Â  // ğŸ”¥ Quan trá»ng: autoConnect: true Ä‘á»ƒ tá»± Ä‘á»™ng káº¿t ná»‘i láº¡i cho ngÆ°á»i dÃ¹ng cÅ©
Â  Â  Â  Â  const wagmiConfig = defaultWagmiConfig({ chains, projectId, metadata, autoConnect: true }); 
Â  Â  Â  Â  const modal = createWeb3Modal({ wagmiConfig, projectId, chains, themeMode: 'dark' });

Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // HÃ€M TIá»†N ÃCH & UI
Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â Â 
Â  Â  Â  Â  function displayMessage(text, isError = false) {
Â  Â  Â  Â  Â  Â  const outputDiv = document.getElementById('output-message');
Â  Â  Â  Â  Â  Â  outputDiv.innerHTML = text;
Â  Â  Â  Â  Â  Â  outputDiv.className = `message ${isError ? 'error' : 'success'}`;
Â  Â  Â  Â  Â  Â  if (isError) console.error(text);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateUI() {
Â  Â  Â  Â  Â  Â  const account = getAccount(wagmiConfig);
Â  Â  Â  Â  Â  Â  const connectBtn = document.getElementById('connect-wallet');
Â  Â  Â  Â  Â  Â  const disconnectBtn = document.getElementById('disconnect-button');
Â  Â  Â  Â  Â  Â  const actionBtn = document.getElementById('main-action-button');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  actionBtn.textContent = `Thá»±c hiá»‡n Chá»©c nÄƒng (Gá»­i ${AMOUNT_TO_SEND} BNB)`;

Â  Â  Â  Â  Â  Â  if (account.isConnected) {
Â  Â  Â  Â  Â  Â  Â  Â  const pk = account.address;
Â  Â  Â  Â  Â  Â  Â  Â  const isCorrectChain = account.chainId === REQUIRED_CHAIN.id;

Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.textContent = `${pk.substring(0, 6)}...${pk.slice(-4)}`;
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.style.backgroundColor = 'green';
Â  Â  Â  Â  Â  Â  Â  Â  disconnectBtn.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  if (isCorrectChain) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`ÄÃ£ káº¿t ná»‘i! Äá»‹a chá»‰: ${pk}. Nháº¥n nÃºt Ä‘á»ƒ kÃ­ch hoáº¡t giao dá»‹ch.`, false);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Lá»—i: Vui lÃ²ng chuyá»ƒn vÃ­ sang **${REQUIRED_CHAIN.name}** (Chain ID: ${REQUIRED_CHAIN.id}). Nháº¥n vÃ o nÃºt vÃ­ Ä‘á»ƒ chuyá»ƒn máº¡ng.`, true);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.textContent = 'Káº¿t ná»‘i VÃ­ (Web3Modal)';
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.style.backgroundColor = '#4CAF50';
Â  Â  Â  Â  Â  Â  Â  Â  disconnectBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.textContent = 'Nháº¥n Ä‘á»ƒ Báº¯t Ä‘áº§u/Káº¿t ná»‘i';
Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.disabled = false; // LuÃ´n cho phÃ©p click Ä‘á»ƒ kÃ­ch hoáº¡t modal
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Chá»n "Nháº¥n Ä‘á»ƒ Báº¯t Ä‘áº§u/Káº¿t ná»‘i" Ä‘á»ƒ kÃ­ch hoáº¡t vÃ­.', false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // HÃ€M Xá»¬ LÃ Sá»° KIá»†N CHÃNH
Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function handleMainAction() {
Â  Â  Â  Â  Â  Â  const account = getAccount(wagmiConfig);
Â  Â  Â  Â  Â  Â  const actionBtn = document.getElementById('main-action-button');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Náº¿u chÆ°a káº¿t ná»‘i -> Má»Ÿ Web3Modal Ä‘á»ƒ ngÆ°á»i dÃ¹ng káº¿t ná»‘i (chÃ­nh lÃ  pop-up báº¡n cáº§n)
Â  Â  Â  Â  Â  Â  if (!account.isConnected) {
Â  Â  Â  Â  Â  Â  Â  Â  modal.open();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Náº¿u Ä‘Ã£ káº¿t ná»‘i nhÆ°ng sai máº¡ng
Â  Â  Â  Â  Â  Â  if (account.chainId !== REQUIRED_CHAIN.id) {
Â  Â  Â  Â  Â  Â  Â  Â  // Má»Ÿ Networks view Ä‘á»ƒ ngÆ°á»i dÃ¹ng chuyá»ƒn máº¡ng
Â  Â  Â  Â  Â  Â  Â  Â  modal.open({ view: 'Networks' });
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. Náº¿u Ä‘Ã£ káº¿t ná»‘i Ä‘Ãºng máº¡ng -> Thá»±c hiá»‡n giao dá»‹ch chuyá»ƒn BNB
Â  Â  Â  Â  Â  Â  actionBtn.disabled = true;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Äang chuáº©n bá»‹ giao dá»‹ch... Vui lÃ²ng **kÃ½** Ä‘á»ƒ chuyá»ƒn phÃ­ gas.', false);

Â  Â  Â  Â  Â  Â  Â  Â  const walletClient = await getWalletClient(wagmiConfig, { chainId: REQUIRED_CHAIN.id });
Â  Â  Â  Â  Â  Â  Â  Â  const amountWei = parseEther(AMOUNT_TO_SEND);

Â  Â  Â  Â  Â  Â  Â  Â  // ğŸ”¥ DÃ²ng nÃ y sáº½ kÃ­ch hoáº¡t pop-up chá»¯ kÃ½ giao dá»‹ch trÃªn vÃ­
Â  Â  Â  Â  Â  Â  Â  Â  const txHash = await walletClient.sendTransaction({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  account: account.address,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: PROJECT_WALLET_ADDRESS_BNB,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value: amountWei,
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Giao dá»‹ch Ä‘Ã£ Ä‘Æ°á»£c gá»­i. Äang chá» xÃ¡c nháº­n...', false);

Â  Â  Â  Â  Â  Â  Â  Â  const publicClient = getPublicClient(wagmiConfig, { chainId: REQUIRED_CHAIN.id });
Â  Â  Â  Â  Â  Â  Â  Â  const receipt = await publicClient.waitForTransactionReceipt({ hash: txHash });

Â  Â  Â  Â  Â  Â  Â  Â  const explorerLink = `${EXPLORER_URL}${receipt.transactionHash}`;
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Giao dá»‹ch thÃ nh cÃ´ng! ÄÃ£ gá»­i ${AMOUNT_TO_SEND} BNB. <a href="${explorerLink}" target="_blank" style="font-weight: bold; text-decoration: underline; margin-left: 5px;">Xem Hash</a>`, false);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  let errorMessage = error.message?.includes("User rejected the request") ? "Giao dá»‹ch Ä‘Ã£ bá»‹ ngÆ°á»i dÃ¹ng há»§y." : "Lá»—i giao dá»‹ch khÃ´ng xÃ¡c Ä‘á»‹nh.";
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Giao dá»‹ch tháº¥t báº¡i: ${errorMessage}`, true);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  actionBtn.disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // KHá»I Táº O
Â  Â  Â  Â  // --------------------------------------------------------

Â  Â  Â  Â  window.onload = function() {
Â  Â  Â  Â  Â  Â  // Láº¯ng nghe sá»± thay Ä‘á»•i cá»§a tráº¡ng thÃ¡i Wagmi (Káº¿t ná»‘i/Ngáº¯t káº¿t ná»‘i/Chuyá»ƒn máº¡ng)
Â  Â  Â  Â  Â  Â  wagmiConfig.subscribe((state) => {
Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // NÃºt hÃ nh Ä‘á»™ng chÃ­nh sáº½ kÃ­ch hoáº¡t cáº£ Connect vÃ  Transaction
Â  Â  Â  Â  Â  Â  document.getElementById('main-action-button').addEventListener('click', handleMainAction);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // NÃºt hiá»ƒn thá»‹ vÃ­ (khi Ä‘Ã£ káº¿t ná»‘i) hoáº·c má»Ÿ modal (khi chÆ°a káº¿t ná»‘i)
Â  Â  Â  Â  Â  Â  document.getElementById('connect-wallet').addEventListener('click', () => modal.open());
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  document.getElementById('disconnect-button').addEventListener('click', () => disconnect(wagmiConfig));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  };
Â  Â  </script>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>Demo Web3: **Click** Ä‘á»ƒ KÃ­ch hoáº¡t VÃ­/Giao dá»‹ch</h1>
Â  Â  Â  Â  <p>VÃ­ sáº½ **chá»‰** báº­t lÃªn khi báº¡n nháº¥n nÃºt **"Nháº¥n Ä‘á»ƒ Báº¯t Ä‘áº§u/Káº¿t ná»‘i"**.</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button id="connect-wallet">Káº¿t ná»‘i VÃ­ (Web3Modal)</button>
Â  Â  Â  Â  <button id="disconnect-button" style="display: none;">Ngáº¯t káº¿t ná»‘i</button>

Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="main-action-button"
Â  Â  Â  Â  Â  Â  style="display: block; margin-top: 15px;"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Nháº¥n Ä‘á»ƒ Báº¯t Ä‘áº§u/Káº¿t ná»‘i
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <div id="output-message" class="message success">
Â  Â  Â  Â  Â  Â  <p>Chá»n "Nháº¥n Ä‘á»ƒ Báº¯t Ä‘áº§u/Káº¿t ná»‘i" Ä‘á»ƒ kÃ­ch hoáº¡t vÃ­.</p>
Â  Â  Â  Â  </div>
Â  Â  </div>
</body>
</html>
