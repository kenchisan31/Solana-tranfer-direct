<!DOCTYPE html>
<html lang="vi">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>BNB Web3Modal DApp (BSC) - Sá»­a lá»—i Auto Pop-up</title>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  body { font-family: sans-serif; margin: 20px; text-align: center; }
Â  Â  Â  Â  .container { max-width: 400px; margin: 50px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .message { margin-top: 20px; padding: 10px; border-radius: 4px; font-size: 0.9em; }
Â  Â  Â  Â  .error { background-color: #fdd; color: #d00; border: 1px solid #f99; }
Â  Â  Â  Â  .success { background-color: #dfd; color: #0d0; border: 1px solid #9f9; }
Â  Â  Â  Â  button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
Â  Â  Â  Â  #connect-wallet { background-color: #4CAF50; color: white; }
Â  Â  Â  Â  #transfer-button { background-color: #FFC04D; color: #333; font-weight: bold; margin-top: 15px; }
Â  Â  Â  Â  #transfer-button:disabled { opacity: 0.5; cursor: not-allowed; }
Â  Â  Â  Â  #disconnect-button { background-color: #999; color: white; }
Â  Â  </style>

Â  Â  <script type="module">
Â  Â  Â  Â  // Loáº¡i bá» 'connect', 'reconnect' khá»i import vÃ¬ Web3Modal/Wagmi sáº½ xá»­ lÃ½
Â  Â  Â  Â  import { createWeb3Modal, defaultWagmiConfig } from 'https://cdn.jsdelivr.net/npm/@web3modal/wagmi@5.0.0/+esm';
Â  Â  Â  Â  import { getAccount, getPublicClient, getWalletClient, disconnect } from 'https://cdn.jsdelivr.net/npm/@wagmi/core@2.11.7/+esm';Â 
Â  Â  Â  Â  import { bsc, bscTestnet } from 'https://cdn.jsdelivr.net/npm/@wagmi/core@2.11.7/chains/+esm';
Â  Â  Â  Â  import { parseEther } from 'https://cdn.jsdelivr.net/npm/viem@2.17.0/+esm';

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // Cáº¤U HÃŒNH DAPP
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  const projectId = '4b51b4de2a00fad2b344df9322b5fd06';Â 
Â  Â  Â  Â  const PROJECT_WALLET_ADDRESS_BNB = '0xc33A186374A2C5360A0ad06B3131ecBb9043c32a';
Â  Â  Â  Â  const AMOUNT_TO_SEND = "0.01";
Â  Â  Â  Â  const REQUIRED_CHAIN = bsc; // BSC Mainnet
Â  Â  Â  Â  const EXPLORER_URL = "https://bscscan.com/tx/";

Â  Â  Â  Â  // Cáº¥u hÃ¬nh Wagmi
Â  Â  Â  Â  const chains = [REQUIRED_CHAIN, bscTestnet];Â 
Â  Â  Â  Â  const metadata = {
Â  Â  Â  Â  Â  Â  name: 'BNB Web3 DApp Demo',
Â  Â  Â  Â  Â  Â  description: 'Gá»­i BNB qua Web3Modal',
Â  Â  Â  Â  Â  Â  url: window.location.origin,
Â  Â  Â  Â  Â  Â  icons: ['https://avatars.githubusercontent.com/u/37784886']
Â  Â  Â  Â  };

Â  Â  Â  Â  // ğŸ”¥ Quan trá»ng: Thiáº¿t láº­p autoConnect: true Ä‘á»ƒ tá»± Ä‘á»™ng káº¿t ná»‘i láº¡i
Â  Â  Â  Â  const wagmiConfig = defaultWagmiConfig({ chains, projectId, metadata, autoConnect: true }); 
Â  Â  Â  Â  const modal = createWeb3Modal({ wagmiConfig, projectId, chains, themeMode: 'dark' });

Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // HÃ€M TIá»†N ÃCH
Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â Â 
Â  Â  Â  Â  function displayMessage(text, isError = false) {
Â  Â  Â  Â  Â  Â  const outputDiv = document.getElementById('output-message');
Â  Â  Â  Â  Â  Â  outputDiv.innerHTML = text;
Â  Â  Â  Â  Â  Â  outputDiv.className = `message ${isError ? 'error' : 'success'}`;
Â  Â  Â  Â  Â  Â  if (isError) console.error(text);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateUI() {
Â  Â  Â  Â  Â  Â  const account = getAccount(wagmiConfig);
Â  Â  Â  Â  Â  Â  const connectBtn = document.getElementById('connect-wallet');
Â  Â  Â  Â  Â  Â  const disconnectBtn = document.getElementById('disconnect-button');
Â  Â  Â  Â  Â  Â  const transferBtn = document.getElementById('transfer-button');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  transferBtn.textContent = `Gá»­i ${AMOUNT_TO_SEND} BNB (BSC Mainnet)`;

Â  Â  Â  Â  Â  Â  if (account.isConnected) {
Â  Â  Â  Â  Â  Â  Â  Â  const pk = account.address;
Â  Â  Â  Â  Â  Â  Â  Â  const isCorrectChain = account.chainId === REQUIRED_CHAIN.id;

Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.textContent = `${pk.substring(0, 6)}...${pk.slice(-4)}`;
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.style.backgroundColor = 'green';
Â  Â  Â  Â  Â  Â  Â  Â  disconnectBtn.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â  transferBtn.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  if (isCorrectChain) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transferBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`ÄÃ£ káº¿t ná»‘i! Äá»‹a chá»‰: ${pk}. Máº¡ng: ${REQUIRED_CHAIN.name}. Sáºµn sÃ ng gá»­i ${AMOUNT_TO_SEND} BNB.`, false);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transferBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transferBtn.style.opacity = '0.5';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Lá»—i: Vui lÃ²ng chuyá»ƒn vÃ­ sang **${REQUIRED_CHAIN.name}** (Chain ID: ${REQUIRED_CHAIN.id}). <span style="font-weight: bold;">Nháº¥n Ä‘á»ƒ chuyá»ƒn.</span>`, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Loáº¡i bá»: modal.open({ view: 'Networks' }); Ä‘á»ƒ trÃ¡nh tá»± Ä‘á»™ng báº­t lÃªn 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // NgÆ°á»i dÃ¹ng sáº½ nháº¥n nÃºt káº¿t ná»‘i Ä‘á»ƒ má»Ÿ modal vÃ  chuyá»ƒn máº¡ng
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.textContent = 'Káº¿t ná»‘i VÃ­ (Web3Modal)';
Â  Â  Â  Â  Â  Â  Â  Â  connectBtn.style.backgroundColor = '#4CAF50';
Â  Â  Â  Â  Â  Â  Â  Â  disconnectBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  transferBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Chá»n "Káº¿t ná»‘i VÃ­" Ä‘á»ƒ báº¯t Ä‘áº§u.', false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // HÃ m tÃ¬m Connector cá»§a vÃ­ Injected (KHÃ”NG Cáº¦N THIáº¾T Ná»®A)
Â  Â  Â  Â  // function getInjectedConnector() { ... }

Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // HÃ€M Xá»¬ LÃ Sá»° KIá»†N (Giá»¯ nguyÃªn)
Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function sendBnbTransaction() {
Â  Â  Â  Â  Â  Â  const account = getAccount(wagmiConfig);
Â  Â  Â  Â  Â  Â  // ... (Logic kiá»ƒm tra vÃ  gá»­i giao dá»‹ch nhÆ° trÆ°á»›c)
Â  Â  Â  Â  Â  Â  Â if (!account.isConnected || account.chainId !== REQUIRED_CHAIN.id) {
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Lá»—i: VÃ­ chÆ°a Ä‘Æ°á»£c káº¿t ná»‘i hoáº·c Ä‘ang á»Ÿ máº¡ng sai.', true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('transfer-button').disabled = true;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Äang gá»­i giao dá»‹ch... Vui lÃ²ng **kÃ½ trÃªn vÃ­** cá»§a báº¡n.', false);

Â  Â  Â  Â  Â  Â  Â  Â  const walletClient = await getWalletClient(wagmiConfig, { chainId: REQUIRED_CHAIN.id });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const amountWei = parseEther(AMOUNT_TO_SEND);

Â  Â  Â  Â  Â  Â  Â  Â  const txHash = await walletClient.sendTransaction({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  account: account.address,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: PROJECT_WALLET_ADDRESS_BNB,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value: amountWei,
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  displayMessage('Äang chá» xÃ¡c nháº­n giao dá»‹ch...', false);

Â  Â  Â  Â  Â  Â  Â  Â  const publicClient = getPublicClient(wagmiConfig, { chainId: REQUIRED_CHAIN.id });
Â  Â  Â  Â  Â  Â  Â  Â  const receipt = await publicClient.waitForTransactionReceipt({ hash: txHash });

Â  Â  Â  Â  Â  Â  Â  Â  const explorerLink = `${EXPLORER_URL}${receipt.transactionHash}`;
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Giao dá»‹ch thÃ nh cÃ´ng! Hash: ${receipt.transactionHash.substring(0, 10)}... <a href="${explorerLink}" target="_blank" style="font-weight: bold; text-decoration: underline; margin-left: 5px;">Xem giao dá»‹ch</a>`, false);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  let errorMessage = 'Lá»—i giao dá»‹ch khÃ´ng xÃ¡c Ä‘á»‹nh.';
Â  Â  Â  Â  Â  Â  Â  Â  if (error.message?.includes("User rejected the request")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = "Giao dá»‹ch Ä‘Ã£ bá»‹ ngÆ°á»i dÃ¹ng há»§y.";
Â  Â  Â  Â  Â  Â  Â  Â  } else if (error.message?.includes("insufficient funds")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = "Lá»—i: KhÃ´ng Ä‘á»§ BNB Ä‘á»ƒ gá»­i hoáº·c thanh toÃ¡n phÃ­ gas.";
Â  Â  Â  Â  Â  Â  Â  Â  } else if (error.message?.includes("revert")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = "Giao dá»‹ch tháº¥t báº¡i: Lá»—i Smart Contract (revert).";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  displayMessage(`Giao dá»‹ch tháº¥t báº¡i: ${errorMessage}`, true);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('transfer-button').disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --------------------------------------------------------
Â  Â  Â  Â  // KHá»I Táº O VÃ€ Tá»° Äá»˜NG KÃCH HOáº T VÃ (ÄÃ£ sá»­a)
Â  Â  Â  Â  // --------------------------------------------------------

Â  Â  Â  Â  window.onload = async function() {
Â  Â  Â  Â  Â  Â  // ğŸ”¥ BÆ¯á»šC 1: Loáº¡i bá» reconnect thá»§ cÃ´ng
Â  Â  Â  Â  Â  Â  // LÃ½ do: defaultWagmiConfig({ ..., autoConnect: true }) Ä‘Ã£ Ä‘áº£m báº£o viá»‡c tá»± Ä‘á»™ng káº¿t ná»‘i láº¡i
Â  Â  Â  Â  Â  Â  // await reconnect(wagmiConfig); // ÄÃ£ loáº¡i bá»

Â  Â  Â  Â  Â  Â  // ğŸ”¥ BÆ¯á»šC 2: Loáº¡i bá» logic káº¿t ná»‘i tá»± Ä‘á»™ng ban Ä‘áº§u
Â  Â  Â  Â  Â  Â  // LÃ½ do: Káº¿t ná»‘i tá»± Ä‘á»™ng khÃ´ng cÃ³ tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng thÆ°á»ng bá»‹ trÃ¬nh duyá»‡t cháº·n (dáº«n Ä‘áº¿n lá»—i hoáº·c khÃ´ng báº­t lÃªn)
Â  Â  Â  Â  Â  Â  // if (!account.isConnected) { ... } // ÄÃ£ loáº¡i bá»

Â  Â  Â  Â  Â  Â  // 3. Láº¯ng nghe vÃ  cáº­p nháº­t UI (Giá»¯ nguyÃªn)
Â  Â  Â  Â  Â  Â  wagmiConfig.subscribe((state) => {
Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Báº¯t sá»± kiá»‡n click
Â  Â  Â  Â  Â  Â  // Khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt nÃ y, Web3Modal sáº½ báº­t lÃªn Ä‘á»ƒ há» chá»n vÃ­ vÃ  káº¿t ná»‘i
Â  Â  Â  Â  Â  Â  document.getElementById('connect-wallet').addEventListener('click', () => modal.open());
Â  Â  Â  Â  Â  Â  document.getElementById('disconnect-button').addEventListener('click', () => disconnect(wagmiConfig));
Â  Â  Â  Â  Â  Â  document.getElementById('transfer-button').addEventListener('click', sendBnbTransaction);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  };
Â  Â  </script>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>Demo Chuyá»ƒn **BNB** (Web3Modal/BSC)</h1>
Â  Â  Â  Â  <p>VÃ­ EVM (MetaMask/Bitget) sáº½ khÃ´ng **tá»± Ä‘á»™ng** báº­t lÃªn ná»¯a, cáº§n nháº¥n **"Káº¿t ná»‘i VÃ­"**.</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button id="connect-wallet">Káº¿t ná»‘i VÃ­ (Web3Modal)</button>
Â  Â  Â  Â  <button id="disconnect-button" style="display: none;">Ngáº¯t káº¿t ná»‘i</button>

Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="transfer-button"
Â  Â  Â  Â  Â  Â  disabled
Â  Â  Â  Â  Â  Â  style="display: none;"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Gá»­i 0.01 BNB (BSC Mainnet)
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <div id="output-message" class="message success">
Â  Â  Â  Â  Â  Â  <p>Äang chá» khá»Ÿi táº¡o...</p>
Â  Â  Â  Â  </div>
Â  Â  </div>
</body>
</html>
